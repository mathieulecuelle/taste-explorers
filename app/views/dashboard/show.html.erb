<div>
  <%= current_user.photo %>
  <br>
  <h2><%= current_user.first_name %> <%= current_user.last_name %></h2>
</div>

<div>
  <%= link_to 'J\'organise', dashboard_path(section: 'organiser'), class: "btn #{'btn-primary' if @section == 'organiser'} #{'btn-info' unless @section == 'organiser'}" %>
  <%= link_to 'Mes résas', dashboard_path(section: 'reservations'), class: "btn #{'btn-primary' if @section == 'reservations'} #{'btn-info' unless @section == 'reservations'}" %>
</div>

<div>
  <% if @section == 'organiser' %>
    <h3>Mes repas à venir</h3>
    <% if @meals.present? %>
      <% @meals.each do |meal| %>
        <% if meal.present? %> <!-- Vérifier si l'objet meal existe -->
          <div class="meal-card">
            <h4><%= meal.title %></h4>
            <p><%= meal.description %></p>
            <p><%= meal.date %></p>
            <p><%= meal.price_per_person %>€</p>
            <p><%= meal.maximum_guests %></p>
            <% if meal.photo.attached? %>
              <%= cl_image_tag meal.photo.key, alt: "Photo du repas #{meal.title}", class: "img-meal" %>
            <% else %>
              <p>Aucune photo disponible pour ce repas</p>
            <% end %>
            <p><%= meal.location %></p>
            <%# <% if meal.date.to_date == Date.today && meal.heure >= Time.now.strftime("%H:%M") %>
              <% if !meal.questions_exist? %>
                <%= link_to "Generate quiz", generate_quiz_path(meal.id),
                    data: { turbo_method: :post },
                    class: "btn btn-dark" %>
              <% end %>
            <%# <% end %>
          </div>
          <br>
        <% end %>
      <% end %>
    <% else %>
      <p>Aucun repas à venir.</p>
    <% end %>
  <% else %>   <%# @section == 'reservations' %>
    <h3>Mes réservations à venir</h3>
    <% if @bookings.present? %>
      <% @bookings.each do |booking| %>
        <% if booking.present? %> <!-- Vérifier si l'objet booking existe -->
          <div class="meal-card">
            <h4><%= booking.meal.title %></h4>
            <p><%= booking.meal.description %></p>
            <p><%= booking.meal.date %></p>
            <p><%= booking.meal.price_per_person %>€</p>
            <p><%= booking.meal.maximum_guests %></p>
            <% if booking.photos.attached? %>
              <%= cl_image_tag booking.photos.first.key, alt: "Photo de la réservation #{booking.id}", class: "img-meal" %>
            <% else %>
              <p>Aucune photo(s) disponible pour cette réservation</p>
            <% end %>
            <p><%= booking.meal.location %></p>
            <p><%= booking.status %></p>
          </div>
          <br>
        <% end %>
      <% end %>
    <% else %>
      <p>Aucune réservation à venir.</p>
    <% end %>
  <% end %>

  <% if @section == 'organiser'%>
    <h3>Mes repas passés</h3>
    <% if @meals_pasts.present? %>
      <% @meals_pasts.each do |meal| %>
        <% if meal.present? %> <!-- Vérifier si l'objet meal existe -->
          <div class="meal-card">
            <h4><%= meal.title %></h4>
            <p><%= meal.description %></p>
            <p><%= meal.date %></p>
            <p><%= meal.price_per_person %>€</p>
            <p><%= meal.maximum_guests %></p>
            <% if meal.photo.attached? %>
              <%= cl_image_tag meal.photo.key, alt: "Photo du repas #{meal.title}", class: "img-meal" %>
            <% else %>
              <p>Aucune photo disponible pour ce repas</p>
            <% end %>
            <p><%= meal.location %></p>
            <% if meal.date.to_date == Date.today && meal.heure >= Time.now.strftime("%H:%M") %>
              <% if !meal.questions_exist? %>
                <%= link_to "Generate quiz", generate_quiz_path(meal.id),
                    data: { turbo_method: :post },
                    class: "btn btn-dark" %>
              <% end %>
            <% end %>
          </div>
          <br>
        <% end %>
      <% end %>
    <% else %>
      <p>Aucun repas passé.</p>
    <% end %>
  <% else %>   <%# @section == 'reservations' %>
    <h3>Mes réservations passées</h3>
    <% if @bookings_pasts.present? %>
      <% @bookings_pasts.each do |booking| %>
        <% if booking.present? %> <!-- Vérifier si l'objet booking existe -->
          <div class="meal-card">
            <h4><%= booking.meal.title %></h4>
            <p><%= booking.meal.description %></p>
            <p><%= booking.meal.date %></p>
            <p><%= booking.meal.price_per_person %>€</p>
            <p><%= booking.meal.maximum_guests %></p>
            <% if booking.photos.attached? %>
              <%= cl_image_tag booking.photos.first.key, alt: "Photo de la réservation #{booking.id}", class: "img-meal" %>
            <% else %>
              <p>Aucune photo(s) disponible pour cette réservation</p>
            <% end %>
            <p><%= booking.meal.location %></p>
            <p><%= booking.status %></p>
          </div>
          <br>
        <% end %>
      <% end %>
    <% else %>
      <p>Aucune réservation passée.</p>
    <% end %>
  <% end %>
</div>
